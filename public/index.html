<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ENTROPY V5 | Hyper-Engine</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script type="importmap">
    { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>
</head>
<body>

    <!-- 1. GRAPHICS LAYER -->
    <div id="hyper-canvas"></div>

    <!-- 2. UI LAYER -->
    <div class="glass-container">
        <header>
            <div class="brand">ENTROPY<span>V5</span></div>
            <div class="subtitle">RENDER COMPETITION BUILD</div>
        </header>

        <div class="controls-area">
            
            <!-- CHAMBER A -->
            <div class="chamber">
                <div class="label">PRIMARY ELEMENT</div>
                <select id="selA">
                    <option value="H2O" selected>Water (H2O)</option>
                    <option value="FIRE">Liquid Fire</option>
                    <option value="U235">Uranium 235</option>
                    <option value="VOID">Void Essence</option>
                    <option value="GOLD">Molten Gold</option>
                    <option value="ANTI">Antimatter</option>
                </select>
                <div class="mass-control">
                    <label>MASS: <span id="valA">50</span>g</label>
                    <input type="range" id="rangeA" min="1" max="100" value="50">
                </div>
            </div>

            <div class="separator">+</div>

            <!-- CHAMBER B -->
            <div class="chamber">
                <div class="label">SECONDARY ELEMENT</div>
                <select id="selB">
                    <option value="LAVA" selected>Magma</option>
                    <option value="NITRO">Nitroglycerin</option>
                    <option value="ACID">Super Acid</option>
                    <option value="COR">Demon Core</option>
                    <option value="STR">Stardust</option>
                </select>
                <div class="mass-control">
                    <label>MASS: <span id="valB">50</span>g</label>
                    <input type="range" id="rangeB" min="1" max="100" value="50">
                </div>
            </div>
            
        </div>

        <!-- ACTIVATE -->
        <button id="ignite">INITIATE REACTION</button>

        <!-- DATA READOUT -->
        <div class="console">
            <div class="log-line">> SYSTEM READY...</div>
            <div class="log-line" id="status-text" style="color:#00E5FF">WAITING FOR INPUT</div>
        </div>

        <!-- DOCS SECTION -->
        <div class="docs-mini">
            API ENDPOINT: <code>POST /api/mix</code><br>
            <i>Try "Antimatter" + "Void" for Reality Collapse.</i>
        </div>
    </div>

    <script type="module">
        import HyperEngine from './js/HyperEngine.js';
        
        // 1. Start Graphics
        window.engine = new HyperEngine('hyper-canvas');

        // 2. Input Handlers
        const rA = document.getElementById('rangeA');
        const rB = document.getElementById('rangeB');
        
        rA.oninput = () => document.getElementById('valA').innerText = rA.value;
        rB.oninput = () => document.getElementById('valB').innerText = rB.value;

        // 3. The Logic Connection
        document.getElementById('ignite').onclick = async () => {
            const btn = document.getElementById('ignite');
            const log = document.getElementById('status-text');
            
            // Animation
            anime({ targets: btn, scale: [0.95, 1], duration: 100 });
            log.innerText = "CALCULATING PHYSICS...";
            log.style.color = "#FFF";

            try {
                // Post Data to Render Backend
                const req = await fetch('/api/mix', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        idA: document.getElementById('selA').value,
                        massA: rA.value,
                        idB: document.getElementById('selB').value,
                        massB: rB.value
                    })
                });
                
                const data = await req.json();

                // Send to GPU
                window.engine.process(data);

                // Update UI
                log.innerText = "EVENT: " + data.meta.event;
                
                if (data.meta.event.includes('COLLAPSE') || data.meta.event.includes('CRITICAL')) {
                    log.style.color = "#FF0055"; // Red Alert
                } else {
                    log.style.color = "#00FFaa";
                }

            } catch (e) {
                console.error(e);
            }
        };
    </script>
</body>
</html>
