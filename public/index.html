<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ALCHEMY V4 | MAGNUM OPUS</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script type="importmap">
    { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>
</head>
<body>

    <!-- 1. RENDER ENGINE -->
    <div id="viewport"></div>

    <!-- 2. UI OVERLAY -->
    <div class="cyber-ui">
        
        <!-- SIDEBAR -->
        <aside class="panel-left" id="sidebar">
            <div class="brand">ALCHEMY_V4</div>
            <p style="font-size:0.8rem; color:#aaa">GPU-Accelerated Matter Simulation API.<br>Host: Render.com<br>Status: ONLINE</p>
            
            <h3>CONTROLS</h3>
            <div class="reactor-grid">
                <button onclick="sim('H2O','SEA')">Oceanic (Fluid)</button>
                <button onclick="sim('CH4','ELEC')">Ion Storm (Plasma)</button>
                <button onclick="sim('VOID','DARK')">Dark Matter (Gyroid)</button>
                <button onclick="sim('U235','PLUT')">Chernobyl (Glitch)</button>
            </div>

            <div class="code-block" id="doc-code">
// IMPORT
import Alchemy from 'https://alchemygl.onrender.com/js/EngineV4.js';

// INIT
const eng = new Alchemy('my-div');

// SIMULATE
await fetch('/api/simulate', {
 body: JSON.stringify({ A: 'VOID', B: 'DARK' })
});
            </div>
        </aside>

        <!-- FLOATING NOTIFICATIONS -->
        <div class="panel-right">
            <h1 id="reaction-name" style="opacity:0">SYSTEM READY</h1>
        </div>

    </div>

    <!-- CRITICAL ALERT OVERLAY -->
    <div id="sys-alert">CRITICAL ERROR</div>

    <!-- LOGIC -->
    <script type="module">
        import AlchemyCore from './js/EngineV4.js';

        // 1. Start Engine
        window.engine = new AlchemyCore('viewport');

        // 2. Intro Animation
        window.onload = () => {
            anime({
                targets: '#sidebar',
                translateX: ['-100%', '0%'],
                opacity: [0, 1],
                duration: 1000,
                easing: 'easeOutExpo'
            });
        };

        // 3. Simulation Logic
        window.sim = async (elA, elB) => {
            // UI Feedback
            document.getElementById('reaction-name').style.opacity = 0;
            anime({ targets: '.panel-left', translateX: -10, direction: 'alternate', duration: 100 });

            // Call Hivemind
            try {
                const req = await fetch('/api/simulate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ A: elA, B: elB })
                });
                const res = await req.json();

                // Send data to GPU
                window.engine.react(res.visual);

                // Update UI text
                const label = document.getElementById('reaction-name');
                label.innerText = res.meta.name;
                anime({ targets: label, opacity: [0,1], duration: 1000 });

                // Alert Check
                const alert = document.getElementById('sys-alert');
                if(res.meta.alert) {
                    alert.innerText = res.meta.alert;
                    alert.style.display = 'block';
                    anime({ 
                        targets: alert, 
                        scale: [0.8, 1.2], 
                        opacity: [0, 1, 0], 
                        duration: 2000, 
                        loop: 2 
                    });
                } else {
                    alert.style.display = 'none';
                }

            } catch(e) { console.error(e); }
        };
    </script>

</body>
</html>
